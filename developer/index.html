<!--Made by Daniel Nogueira(daniel@leafcomputer.com.br or danielnogueira97@gmail.com)-->
<html>
<head>
	<title>LeafDev</title>
	<meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name = "viewport" content = "initial-scale = 0.75, user-scalable = no">
    <link rel="apple-touch-icon-precomposed" href="icon.png"/>
	<link rel="stylesheet" href="main.css" type="text/css"/>
	<script src="sjcl.js"></script>
	<script src="socket.io.js"></script>
	<script>
	ChatServerAddress = "http://leafdev.hp.af.cm:1333/";
	ontitle = false;
	hasFocus = false;
	
	function Connect(name)
	{
	socket = io.connect(ChatServerAddress);
	console.log(socket);
	socket.emit('set user', name);
	
	socket.on('SuccessfulLogin', function () {
	//Load Chat Elements
        Name.style.opacity = "0";
		Name.style.top = "40%";
		Name.disabled = true;
		Password.style.opacity = "0";
		Password.style.top = "40%";
		Password.disabled = true;
		Join.style.top = "40%";
		Join.style.opacity = "0";
		document.getElementById("Connect").style.opacity = "0";
		document.getElementById("Connect").style.pointerEvents = "none";
		Chat.style.opacity = "1";
		msgcomposer.disabled = false;
	});
	
	socket.on('LoginError', function () {
	ShowElement('name');
        Name.style.color = "f00";
	});
	
	socket.on('msg', function (message) {
	//Load message
	console.log(message.message);
	TheRow = document.createElement("tr");
	document.getElementById("messages").appendChild(TheRow);
	TheTime = document.createElement("td");
	TheTime.innerText = message.time;
	TheTime.className = "Date";
	TheRow.appendChild(TheTime);
	TheSender = document.createElement("td");
	TheSender.innerText = message.from;
	TheSender.className = "Sender";
	TheRow.appendChild(TheSender);
	TheMessage = document.createElement("td");
	try
	{
		TheMessage.innerText = sjcl.decrypt(Password.value,message.message);
	}
	catch(err)
	{
		if(message.from == "Server")
		{
			TheMessage.innerText = message.message;
		}
		else
		{
			TheMessage.innerText = "(Message encrypted with different password)";
		}
	}
	TheMessage.className = "LaMensaje";
	TheRow.appendChild(TheMessage);
	ScrollToBottom();
	});
	}

	
	
	function Load()
	{
		title.style.opacity = "1";
		title.style.top = "50%";
		ontitle = true;
		var ua = navigator.userAgent.toLowerCase();
		msgcomposer.disabled = true;
		if (ua.indexOf('safari')!=-1){ 
		if(ua.indexOf('chrome')  > -1)
		{
			//chrome
		}
		else
		{
			//safari
			Name.value = "Name";
			Password.value = "pass";
		}
	}
	}
	
	function LoadNameInput()
	{
		title.style.opacity = "1";
		title.style.top = "35%";
		ontitle = false;
		Name.style.opacity = "1";
		Name.style.top = "50%";
		Name.focus();
	}
	
	function FocusForm(which)
	{
	console.log("focus on " + which);
	if(which == "name")
	{
		Password.style.opacity = "0";
		Password.style.top = "60%";
		Name.style.opacity = "1";
		Name.style.top = "50%";
		Join.style.top = "60%";
		Join.style.opacity = "0";
		Name.style.pointerEvents = "auto";
		Password.style.pointerEvents = "none";
		Join.style.pointerEvents = "none";
		Name.focus();
	}
	else if(which == "password")
	{
		Name.style.opacity = "0";
		Name.style.top = "40%";
		Password.style.opacity = "1";
		Password.style.top = "50%";
		Join.style.top = "60%";
		Join.style.opacity = "0";
		Name.style.pointerEvents = "none";
		Password.style.pointerEvents = "auto";
		Join.style.pointerEvents = "none";
		Password.focus();
	}
	else if(which == "join")
	{
		Name.style.opacity = "0";
		Name.style.top = "40%";
		Password.style.opacity = "0";
		Password.style.top = "40%";
		Join.style.top = "50%";
		Join.style.opacity = "1";
		Name.style.pointerEvents = "none";
		Password.style.pointerEvents = "none";
		Join.style.pointerEvents = "auto";
	}
	}
	
	function ShowElement(which)
	{
	if(which == "password")
        {
        Password.style.opacity = "1";
        Password.style.pointerEvents = "auto";
		}
	else if(which == "name")
        {
        Name.style.opacity = "1";
        Name.style.pointerEvents = "auto";
		}
	else if(which == "join")
        {
        Join.style.opacity = "1";
        Join.style.pointerEvents = "auto";
		}
        }

        function HideElement(which)
		{
	if(which == "password")
        {
        Password.style.opacity = "0";
		}
	else if(which == "name")
        {
        Name.style.opacity = "0";
		}
	else if(which == "join")
        {
        Join.style.opacity = "0";
		}
        }
        
        function ShowPrevious()
        {
        	if(Password.style.top == "50%")
        	{
        		ShowElement('name');
        	}
        	else if(Join.style.top == "50%")
        	{
        		ShowElement('password');
        	}
        }
        
        function ScrollToBottom()
        {
			document.getElementById("msgcontainer").scrollTop = document.getElementById("msgcontainer").scrollHeight;
        }
        
        function OnKeyUpPass(e) {
        if (e.keyCode == 13) {
		Connect(Name.value)
    }
}
	</script>
	
</head>
<body id="TheBody" onload="setTimeout('Load()', 1000)" onmousemove="if(ontitle){LoadNameInput()}" ontouchend="if(ontitle){LoadNameInput()}">
	<div id="Connect">
		<h1 id="title" onclick="ShowPrevious()" onmouseover="ShowPrevious()">LeafDev</h1>
		<input onfocus="FocusForm('name')" onblur="FocusForm('password')" id="Name" class="logininput" oninput="if(Name.value != ''){ShowElement('password');}else{ HideElement('password');}" placeholder="Name">
		<input id="Password" onfocus="FocusForm('password')" onblur="FocusForm('join')" type="password" class="logininput" onkeyup="OnKeyUpPass(event)" oninput="if(Password.value != ''){ShowElement('join');HideElement('name');}else{ HideElement('join');}" placeholder="Password">
		<button id="Join" onclick="Connect(Name.value);">Join</button>
	</div>
	<div id="Chat">
		<span id="UserIndicator"></span>
		<div id="msgcontainer">
		<table id="messages">
		</table>
		</div>
		<input placeholder="Type the Message here..." id="msgcomposer" type="search" onsearch="socket.emit('msg', sjcl.encrypt(Password.value, this.value));this.value = '';this.focus();ScrollToBottom();">
	</div>
</body>
</html>